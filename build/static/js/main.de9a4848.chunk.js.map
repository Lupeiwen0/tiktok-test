{"version":3,"sources":["server.js","index.jsx","index.js"],"names":["getTicket","a","axios","post","data","ticket","client_key","calcSignature","nonce_str","timestamp","url","str","md5","getConfigParams","signature","location","window","href","String","parseInt","Date","now","useState","sdk","setSdk","ready","setReady","configStatus","setConfigStatus","resultMsg","setResultMsg","setClientKey","config","useCallback","params","useEffect","douyin_open","error","res","JSON","stringify","onClick","reload","className","jumpOpenAuth","redirect_uri","state","scope","response_type","success","VConsole","ReactDOM","render","document","getElementById"],"mappings":"6OAMMA,EAAS,uCAAG,kCAAAC,EAAA,sEACOC,IAAMC,KAAK,qDADlB,uBACRC,EADQ,EACRA,KADQ,EAEeA,EAAKA,MAAQ,GAApCC,EAFQ,EAERA,OAFQ,EAEAC,WAFA,kBAGTD,GAHS,2CAAH,qDAQTE,EAAgB,SAAC,GAA2C,IAAzCF,EAAwC,EAAxCA,OAAQG,EAAgC,EAAhCA,UAAWC,EAAqB,EAArBA,UAAWC,EAAU,EAAVA,IAC/CC,EAAG,uBAAmBN,EAAnB,sBAAuCG,EAAvC,sBAA8DC,EAA9D,gBAA+EC,GAExF,OADYE,IAAID,IAMLE,EAAe,uCAAG,yCAAAZ,EAAA,6DAASQ,EAAT,EAASA,UAAWD,EAApB,EAAoBA,UAAWE,EAA/B,EAA+BA,IAA/B,SACMV,IADN,uBACtBM,EADsB,EACtBA,WAAYD,EADU,EACVA,OADU,SAELE,EAAc,CAAEF,SAAQI,YAAWD,YAAWE,QAFzC,cAEvBI,EAFuB,yBAGtB,CAAER,aAAYQ,cAHQ,4CAAH,sDCnBpBC,EAAaC,OAAbD,SACFL,EAAMK,EAASE,KAEfR,EAAYS,OAAOC,SAASC,KAAKC,MAAQ,MAKhC,aAAO,IAAD,EACGC,mBAAS,MADZ,mBACZC,EADY,KACPC,EADO,OAEOF,oBAAS,GAFhB,mBAEZG,EAFY,KAELC,EAFK,OAGqBJ,mBAAS,IAH9B,mBAGZK,EAHY,KAGEC,EAHF,OAIeN,mBAAS,IAJxB,mBAIZO,EAJY,KAIDC,EAJC,OAKgBR,mBAAS,IALzB,mBAKZhB,EALY,KAKAyB,EALA,KAqCbC,EAASC,sBAAW,sBAAC,gCAAAhC,EAAA,sEACeY,EAAgB,CAAEJ,YAAWD,UA1CvD,mBA0CkEE,QADvD,gBACjBJ,EADiB,EACjBA,WAAYQ,EADK,EACLA,UAEpBS,EAAIS,OAAO,CACTE,OAAQ,CACN5B,aACAQ,YACAL,YACAD,UAjDU,mBAkDVE,SAGJqB,EAAazB,GAZY,2CAaxB,CAACiB,IAmBJ,OAjBAY,qBAAU,WACRX,EAAOR,OAAOoB,aACVb,IACFK,EAAgB,cAChBI,IAEAT,EAAIE,OAAM,WACRC,GAAS,GACTE,EAAgB,uBAGlBL,EAAIc,OAAM,SAAAC,GACRV,EAAgB,qBAAD,OAAsBW,KAAKC,UAAUF,WAGvD,CAACf,EAAKS,IAGP,oCACE,uBAAGS,QAAS,kBAAM1B,EAAS2B,UAAUC,UAAU,QAAQ,UACvD,2BAAIhB,EAAJ,KAEGF,EACC,oCACE,uBAAGgB,QApEO,WACdhB,GACFF,EAAIqB,aAAa,CACfV,OAAQ,CACN5B,aACAuC,aAAc9B,EAASE,KACvB6B,MAAO,GACPC,MAAO,YACPC,cAAe,QAEjBC,QAAS,gBAAG5C,EAAH,EAAGA,OAAH,OAAgByB,EAAa,iBAAD,OAAkBzB,KACvDgC,MAAO,SAAAC,GAAG,OAAIR,EAAa,eAAD,OAAgBS,KAAKC,UAAUF,SAyD5BK,UAAU,QAAnC,QA/EA,IA6EK,yCAOX,2BAAId,K,QCxFV,I,OAAIqB,GACJC,IAASC,OACP,kBAAC,EAAD,MACAC,SAASC,eAAe,W","file":"static/js/main.de9a4848.chunk.js","sourcesContent":["// ⚠️注意：本文件内的逻辑请在服务端实现，本Demo只展示用\nimport axios from 'axios';\nimport md5 from 'md5';\n\n// 获取 Ticket\n// 详细说明见 http://open-boe.douyin.com/platform/doc/JS-guide\nconst getTicket = async () => {\n  const { data } = await axios.post('https://dy-speed-test.yiye.ai/api/v1/qyh/jsticket');\n  const { ticket, client_key } = data.data || {};\n  return ticket;\n};\n\n// 计算签名\n// 将从服务端获取到的 ticket，随机字串 noncestr，时间戳 timestamp和当前页面url，排序后进行md5加密生成签名\nconst calcSignature = ({ ticket, nonce_str, timestamp, url }) => {\n  const str = `jsapi_ticket=${ticket}&nonce_str=${nonce_str}&timestamp=${timestamp}&url=${url}`;\n  const sig = md5(str);\n  return sig;\n};\n\n// 先获取 Client Token，然后通过 Token 获取 JS Ticket\n// 详细说明见 https://open.douyin.com/platform/doc/OpenAPI-oauth2\nexport const getConfigParams = async ({ timestamp, nonce_str, url }) => {\n  const {client_key, ticket} = await getTicket();\n  const signature = await calcSignature({ ticket, timestamp, nonce_str, url });\n  return { client_key, signature };\n};\n","import React, { useState, useEffect, useCallback } from 'react';\nimport { getConfigParams } from './server';\n\nconst { location } = window;\nconst url = location.href;\n\nconst timestamp = String(parseInt(Date.now() / 1000)); // 生成签名用的时间戳\nconst nonce_str = 'Wm3WZYTPz0wzccnW'; // 生成签名用的随机字符串\nconst jsb = ''; // 自定义测试用JSB方法名\nconst params = {}; // 自定义测试用JSB方法参数\n\nexport default () => {\n  const [sdk, setSdk] = useState(null);\n  const [ready, setReady] = useState(false);\n  const [configStatus, setConfigStatus] = useState('');\n  const [resultMsg, setResultMsg] = useState('');\n  const [client_key, setClientKey] = useState('');\n\n  // 打开原生授权页面JSB能力示例\n  const onClickAuth = () => {\n    if (ready) {\n      sdk.jumpOpenAuth({\n        params: {\n          client_key,\n          redirect_uri: location.href,\n          state: '',\n          scope: 'user_info',\n          response_type: 'code'\n        },\n        success: ({ ticket }) => setResultMsg(`Auth Success: ${ticket}`),\n        error: res => setResultMsg(`Auth Error: ${JSON.stringify(res)}`)\n      });\n    }\n  };\n\n  // 可在URL参数中自定义JSB方法名和参数以测试\n  const onClickJSB = () => {\n    if (ready) {\n      sdk[jsb]({\n        params,\n        success: res => setResultMsg(`JSB ${jsb} Success: ${JSON.stringify(res)}`),\n        error: res => setResultMsg(`JSB ${jsb} Error: ${JSON.stringify(res)}`)\n      });\n    }\n  };\n\n\n  // 使用JSB能力前，必须先通过Config验证签名\n  const config = useCallback(async () => {\n    const { client_key, signature } = await getConfigParams({ timestamp, nonce_str, url });\n\n    sdk.config({\n      params: {\n        client_key,\n        signature,\n        timestamp,\n        nonce_str,\n        url\n      }\n    });\n    setClientKey(client_key);\n  }, [sdk]);\n\n  useEffect(() => {\n    setSdk(window.douyin_open);\n    if (sdk) {\n      setConfigStatus('SDK Loaded');\n      config();\n\n      sdk.ready(() => {\n        setReady(true);\n        setConfigStatus('SDK Config Ready');\n      });\n\n      sdk.error(res => {\n        setConfigStatus(`SDK Config Error: ${JSON.stringify(res)}`);\n      });\n    }\n  }, [sdk, config]);\n\n  return (\n    <>\n      <p onClick={() => location.reload()} className=\"link\">{'Reload'}</p>\n      <p>{configStatus} </p>\n      {\n        !ready ? <p>Loading...</p> : (\n          <>\n            <p onClick={onClickAuth} className=\"link\">Auth</p>\n            {jsb && <p onClick={onClickJSB} className=\"link\" style={{ textTransform: 'capitalize' }}>{jsb}</p>}\n          </>\n        )\n      }\n      <p>{resultMsg}</p>\n    </>\n  );\n};","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Index from './index.jsx';\nimport VConsole from 'vconsole';\nnew VConsole();\nReactDOM.render(\n  <Index />,\n  document.getElementById('root')\n);"],"sourceRoot":""}